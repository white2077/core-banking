#!/bin/sh
# Pre-commit hook - ch·∫°y Spotless v√† PMD check tr∆∞·ªõc khi commit

echo "üîç Running Spotless check..."

# Ch·∫°y spotless:check
./mvnw spotless:check -q

if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå Code format check FAILED!"
    echo ""
    echo "Run './mvnw spotless:apply' to auto-fix formatting issues."
    echo ""
    exit 1
fi

echo "‚úÖ Spotless check passed!"
echo ""
echo "üîç Running PMD check..."

# Ch·∫°y pmd:check
./mvnw pmd:check -q

if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå PMD check FAILED!"
    echo ""
    echo "Fix the code quality issues reported above."
    echo ""
    exit 1
fi

echo "‚úÖ PMD check passed!"
echo ""
echo "üîç Running CPD (Copy-Paste Detector)..."

# Ch·∫°y cpd:check
./mvnw pmd:cpd-check -q

if [ $? -ne 0 ]; then
    echo ""
    echo "‚ùå CPD check FAILED! Duplicate code detected."
    echo ""
    echo "Fix the duplicate code issues reported above."
    echo ""
    exit 1
fi

echo "‚úÖ CPD check passed!"
echo ""
echo "üéâ All checks passed! Commit allowed."
exit 0

